\documentclass[10pt]{article}
\usepackage[utf8]{inputenc}

% Page setup
\usepackage[a3paper,landscape,margin=2cm]{geometry}

% Typography
\usepackage[scaled]{berasans}
\renewcommand*\familydefault{\sfdefault}
\usepackage[T1]{fontenc}
\parindent 0pt

% TikZ
\usepackage{./tikz-uml}
\usetikzlibrary{positioning}

\begin{document}

{
\Large
Solid server -- Proposed architecture v1.0.0
(status: work in progress)

\large
Ruben Verborgh

\vspace{2em}

\begin{tikzpicture}

\begin{umlpackage}{HTTP}
  \umlinterface[]{HttpHandler}{}{
    + canHandle(HttpRequest) : Promise<boolean>\\
    + handle(HttpRequest, HttpResponse) : void\\
  }

  \umlclass[right=1 of HttpHandler]{HttpServer}{}{
    + HttpServer(Array<HttpHandler>)\\
    + listen(port : int) : void\\
    + handle(HttpRequest, HttpResponse) : void\\
  }
  \umlaggreg[mult=*]{HttpServer}{HttpHandler}
\end{umlpackage}

\begin{umlpackage}[y=-5]{LDP}
  \umlclass{LdpHandler}{}{
    + LdpHandler(OperationFactory)\\
    + handle(HttpRequest, HttpResponse) : void\\
  }
  \umlimpl{LdpHandler}{HttpHandler}


  \umlsimpleclass[right=2 of LdpHandler.north east]{TargetExtractor}
  \umlaggreg[mult=1]{LdpHandler}{TargetExtractor}

  \umlsimpleclass[right=2 of TargetExtractor]{ResourceIdentifier}
  \umldep[arg=creates]{TargetExtractor}{ResourceIdentifier}


  \umlsimpleclass[below=0.5 of TargetExtractor.south west,anchor=north west]{BodyParser}
  \umlaggreg[mult=*]{LdpHandler}{BodyParser}

  \umlsimpleclass[right=2 of BodyParser]{Representation}
  \umldep[arg=creates]{BodyParser}{Representation}

  \umlsimpleclass[right=1 of Representation]{Patch}
  \umlinherit{Patch}{Representation}


  \begin{umlpackage}[x=5,y=-3]{Operations}
    \umlclass[]{OperationFactory}{}{
      + OperationFactory(ResourceStore)\\
    }
    \umlaggreg[mult=1,geometry=|-]{LdpHandler}{OperationFactory}

    \umlinterface[below=0.5 of OperationFactory]{Operation}{
      + target : ResourceIdentifier\\
      + body : Representation\\
      + requiredPermissions : PermissionSet\\
    }{
      + execute() : Promise<ResponseDescription>\\
    }
    \umldep{OperationFactory}{Operation}

    \umlsimpleclass[right=1 of Operation.north east,anchor=south west]{GetOperation}
    \umlsimpleclass[below=.25 of GetOperation.south west,anchor=north west]{PostOperation}
    \umlsimpleclass[below=.25 of PostOperation.south west,anchor=north west]{PutOperation}
    \umlsimpleclass[below=.25 of PutOperation.south west,anchor=north west]{PatchOperation}
    \umlimpl{GetOperation}{Operation}
    \umlimpl{PostOperation}{Operation}
    \umlimpl{PutOperation}{Operation}
    \umlimpl{PatchOperation}{Operation}

  \end{umlpackage}
\end{umlpackage}

\begin{umlpackage}{Storage}
  \umlinterface[below=3 of Operation]{ResourceStore}{}{
    + getRepresentation(ResourceIdentifier): Promise<Representation>\\
    + addResource(container: ResourceIdentifier, Representation): Promise<ResourceIdentifier>\\
    + setRepresentation(ResourceIdentifier, Representation): Promise<void>\\
    + deleteResource(ResourceIdentifier): Promise<void>\\
    + modifyResource(ResourceIdentifier, Patch): Promise<void>\\
  }
  \umlaggreg[mult=1]{Operation}{ResourceStore}
\end{umlpackage}

\begin{umlpackage}{Authentication}
  \umlinterface[left=2 of LdpHandler.west]{CredentialsExtractor}{}{
    + extractCredentials(HttpRequest): Promise<Credentials>\\
  }
  \umlaggreg[mult=1]{LdpHandler}{CredentialsExtractor}
\end{umlpackage}

\begin{umlpackage}{Authorization}
  \umlinterface[below=2 of CredentialsExtractor.south east,anchor=north east]{Authorizer}{}{
    + hasPermissions(Credentials,
                     ResourceIdentifier,\\*
                     PermissionSet) : Promise<boolean>\\
  }
  \umlaggreg[mult=1,geometry=|-|]{LdpHandler}{Authorizer}

  \umlsimpleclass[below=1 of Authorizer]{AclBasedAuthorizer}
  \umlimpl{AclBasedAuthorizer}{Authorizer}
  \umlaggreg[mult=1,geometry=|-]{AclBasedAuthorizer}{ResourceStore}
\end{umlpackage}

\end{tikzpicture}

\end{document}
